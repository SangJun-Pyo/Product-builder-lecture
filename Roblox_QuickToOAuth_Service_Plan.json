{
  "title": "Roblox User Playstyle Analysis (Quick → OAuth Full)",
  "version": "1.1",
  "language_support": [
    "en",
    "ko"
  ],
  "positioning": {
    "goal": "Entertainment-driven, privacy-first playstyle insights (MBTI-like archetypes)",
    "non_goals": [
      "Exact playtime tracking across Roblox",
      "Accessing private PII from Roblox (email, DOB, etc.) beyond documented scopes"
    ]
  },
  "architecture": {
    "two_stage_flow": [
      {
        "stage": "quick",
        "name": "Quick Analysis (No Login)",
        "purpose": "Low-friction 'taste' result to drive conversion to OAuth Full Analysis",
        "auth": {
          "roblox_oauth": false,
          "api_key_required": false,
          "notes": [
            "Quick stage primarily uses publicly accessible signals.",
            "API Key is not used to increase access to a user's private data; it may be used only for service-side operational needs if applicable."
          ]
        },
        "inputs": [
          {
            "type": "roblox_username_or_userid",
            "required": true
          },
          {
            "type": "mini_survey",
            "required": false,
            "description": "Optional 2–3 questions to boost perceived accuracy"
          }
        ],
        "data_sources": {
          "public_signals_only": true,
          "examples": [
            "Public profile basics (display name, avatar thumbnail, account age)",
            "Public badges/groups (where available)",
            "Publicly inferable genre keywords from badge/group names (heuristic)"
          ],
          "not_used": [
            "Private friend lists",
            "Transaction history",
            "Exact per-game playtime",
            "Any secret tokens/cookies"
          ]
        },
        "outputs": {
          "result_type": "lite",
          "fields": [
            "primary_archetype",
            "scores_partial (optional)",
            "confidence (lower)",
            "cta_to_oauth_full"
          ],
          "ui_notes": [
            "Label as Quick Guess / Lite Analysis",
            "Show confidence and explain it's an estimate based on limited signals"
          ]
        }
      },
      {
        "stage": "full",
        "name": "Full Analysis (Roblox OAuth + Consent)",
        "purpose": "Higher-confidence personalized result with explicit user consent",
        "auth": {
          "roblox_oauth": true,
          "oauth_flow": "Authorization Code Flow (confidential client)",
          "consent_required": true,
          "recommended_scopes_mvp": [
            "openid",
            "profile"
          ],
          "notes": [
            "Scopes must follow Roblox documentation and minimum-privilege principle.",
            "If additional Roblox APIs support OAuth tokens, expand scopes incrementally."
          ]
        },
        "inputs": [
          {
            "type": "roblox_oauth_login",
            "required": true
          },
          {
            "type": "full_survey",
            "required": true,
            "description": "8-question archetype survey (Likert 1–5)"
          }
        ],
        "data_sources": {
          "consent_based": true,
          "examples": [
            "Identity (Roblox user id) via OAuth",
            "Profile-level info within granted scopes",
            "Any additional Open Cloud endpoints permitted by granted scopes (future expansion)"
          ]
        },
        "outputs": {
          "result_type": "full",
          "fields": [
            "primary_archetype",
            "secondary_archetype",
            "scores (8 archetypes)",
            "confidence (higher)",
            "top_reasons (localized keys)",
            "share_card"
          ]
        }
      }
    ]
  },
  "archetypes": [
    {
      "key": "explorer",
      "name": {
        "en": "Explorer",
        "ko": "탐험형"
      },
      "definition": {
        "en": "Enjoys discovering new games and genres.",
        "ko": "새로운 게임과 장르를 찾아다니는 성향."
      }
    },
    {
      "key": "grinder",
      "name": {
        "en": "Grinder",
        "ko": "파밍형"
      },
      "definition": {
        "en": "Focuses on long-term progression and repetition.",
        "ko": "반복 루프와 장기 성장을 즐기는 성향."
      }
    },
    {
      "key": "socializer",
      "name": {
        "en": "Socializer",
        "ko": "사교형"
      },
      "definition": {
        "en": "Plays mainly for social interaction.",
        "ko": "사람들과 어울리는 것이 중심인 성향."
      }
    },
    {
      "key": "competitor",
      "name": {
        "en": "Competitor",
        "ko": "경쟁형"
      },
      "definition": {
        "en": "Enjoys PvP, ranking, and skill improvement.",
        "ko": "승부/랭킹/실력 향상을 즐기는 성향."
      }
    },
    {
      "key": "builder",
      "name": {
        "en": "Builder",
        "ko": "창작형"
      },
      "definition": {
        "en": "Interested in creating, building, and customization.",
        "ko": "만들기/건축/커스터마이징에 관심이 큰 성향."
      }
    },
    {
      "key": "trader",
      "name": {
        "en": "Trader",
        "ko": "경제형"
      },
      "definition": {
        "en": "Focused on item value and trading.",
        "ko": "아이템 가치/거래에 관심이 큰 성향."
      }
    },
    {
      "key": "roleplayer",
      "name": {
        "en": "Roleplayer",
        "ko": "몰입형"
      },
      "definition": {
        "en": "Immerses in story, character, and roleplay.",
        "ko": "스토리/캐릭터/역할놀이에 몰입하는 성향."
      }
    },
    {
      "key": "casual",
      "name": {
        "en": "Casual",
        "ko": "라이트형"
      },
      "definition": {
        "en": "Light, short play sessions without deep focus.",
        "ko": "부담 없이 가볍게 즐기는 성향."
      }
    }
  ],
  "scoring": {
    "survey_weight_default": 0.7,
    "public_signal_weight_default": 0.3,
    "dynamic_weighting": {
      "based_on_signal_strength": true,
      "note": "If public signals are sparse, increase survey weight (e.g., 0.85/0.15)."
    },
    "confidence": {
      "formula_description": "confidence ≈ 0.4*signal_strength + 0.6*(top1-top2 margin), clamped 0..1",
      "display_rules": [
        "Quick results show lower confidence and stronger disclaimer",
        "Full results can show higher confidence and top reasons"
      ]
    }
  },
  "data_policy": {
    "principles": [
      "Minimum data collection",
      "Purpose limitation",
      "Derived-metrics-first storage",
      "User control (revoke and delete)"
    ],
    "collected_quick": [
      "Public profile basics",
      "Public badges/groups (if publicly available)",
      "Optional mini-survey"
    ],
    "collected_full": [
      "Roblox identity via OAuth",
      "Profile data within granted scopes",
      "Full survey responses",
      "Derived behavioral signals and final results"
    ],
    "not_collected": [
      "Exact playtime per game",
      "Private friend list contents",
      "Transaction history",
      "Any secrets/cookies (e.g., .ROBLOSECURITY)",
      "PII not provided by Roblox scopes (email/DOB) unless user separately inputs it on your site with explicit consent"
    ],
    "retention": {
      "raw_cache_ttl_hours": 72,
      "derived_metrics_retained_until": "consent_revoked_or_account_deleted"
    }
  },
  "database_schema": {
    "tables": {
      "users": [
        "id(uuid)",
        "roblox_user_id(bigint, unique)",
        "created_at",
        "updated_at",
        "last_login_at",
        "locale_default"
      ],
      "consents": [
        "id",
        "user_id",
        "consent_version",
        "scopes(jsonb)",
        "agreed_at",
        "revoked_at(nullable)"
      ],
      "oauth_tokens": [
        "id",
        "user_id",
        "provider('roblox')",
        "access_token_encrypted",
        "refresh_token_encrypted(nullable)",
        "expires_at",
        "created_at",
        "revoked_at(nullable)"
      ],
      "survey_responses": [
        "id",
        "user_id",
        "version",
        "answers(jsonb)",
        "created_at"
      ],
      "user_signals": [
        "user_id(pk)",
        "signal_strength(float)",
        "friend_count_norm(float, optional)",
        "group_count_norm(float, optional)",
        "genre_entropy(float, optional)",
        "top_genre_ratio(float, optional)",
        "keyword_hits(jsonb)",
        "computed_at"
      ],
      "archetype_results": [
        "id",
        "user_id",
        "stage('quick'|'full')",
        "model_version",
        "primary_type",
        "secondary_type(nullable)",
        "scores(jsonb)",
        "confidence(float)",
        "explanation(jsonb: reason_keys)",
        "created_at"
      ],
      "public_share_cards": [
        "id",
        "user_id",
        "result_id",
        "share_slug(unique)",
        "locale",
        "is_public",
        "created_at",
        "expires_at(nullable)"
      ],
      "raw_cache_optional": [
        "raw_profile_cache(user_id, payload, fetched_at, ttl_expires_at)",
        "raw_badges_cache(user_id, payload, fetched_at, ttl_expires_at)",
        "raw_groups_cache(user_id, payload, fetched_at, ttl_expires_at)"
      ]
    }
  },
  "api": {
    "public_quick": [
      {
        "method": "GET",
        "path": "/public/resolve",
        "query": [
          "username"
        ],
        "returns": [
          "roblox_user_id"
        ]
      },
      {
        "method": "GET",
        "path": "/public/signals",
        "query": [
          "roblox_user_id"
        ],
        "returns": [
          "public_signal_summary"
        ]
      },
      {
        "method": "POST",
        "path": "/analysis/quick",
        "body": [
          "roblox_user_id",
          "mini_survey(optional)"
        ],
        "returns": [
          "quick_result"
        ]
      }
    ],
    "oauth_auth": [
      {
        "method": "GET",
        "path": "/auth/roblox/login",
        "returns": [
          "redirect_to_roblox_authorize"
        ]
      },
      {
        "method": "GET",
        "path": "/auth/roblox/callback",
        "returns": [
          "session_established",
          "consent_prompt_if_needed"
        ]
      },
      {
        "method": "POST",
        "path": "/auth/logout",
        "returns": [
          "session_cleared"
        ]
      }
    ],
    "consent": [
      {
        "method": "GET",
        "path": "/consent/text",
        "query": [
          "locale",
          "version"
        ],
        "returns": [
          "consent_text"
        ]
      },
      {
        "method": "POST",
        "path": "/consent/agree",
        "body": [
          "version",
          "scopes"
        ],
        "returns": [
          "ok"
        ]
      },
      {
        "method": "POST",
        "path": "/consent/revoke",
        "returns": [
          "ok_and_deletion_started"
        ]
      }
    ],
    "full_analysis": [
      {
        "method": "POST",
        "path": "/survey/submit",
        "body": [
          "version",
          "answers"
        ],
        "returns": [
          "ok"
        ]
      },
      {
        "method": "POST",
        "path": "/analysis/full",
        "body": [
          "options(optional)"
        ],
        "returns": [
          "full_result"
        ]
      },
      {
        "method": "GET",
        "path": "/analysis/latest",
        "query": [
          "stage(optional)"
        ],
        "returns": [
          "latest_result"
        ]
      }
    ],
    "share": [
      {
        "method": "POST",
        "path": "/share/create",
        "body": [
          "result_id",
          "locale",
          "is_public"
        ],
        "returns": [
          "share_url"
        ]
      },
      {
        "method": "GET",
        "path": "/share/{share_slug}",
        "returns": [
          "public_share_page_data"
        ]
      }
    ],
    "i18n": [
      {
        "method": "GET",
        "path": "/i18n/locales",
        "returns": [
          "en",
          "ko"
        ]
      },
      {
        "method": "GET",
        "path": "/i18n/messages",
        "query": [
          "locale"
        ],
        "returns": [
          "message_bundle_json"
        ]
      }
    ]
  },
  "i18n_design": {
    "storage_rule": "Store only localization keys in DB (e.g., explanation.reason_keys). Render localized strings via message bundles.",
    "bundles": {
      "en": "messages/en.json",
      "ko": "messages/ko.json"
    },
    "url_strategy_optional": [
      "/en/...",
      "/ko/..."
    ]
  },
  "mvp_scope": {
    "quick": [
      "Username search",
      "Public-signal quick scoring",
      "Lite result + CTA to login"
    ],
    "full": [
      "Roblox OAuth login",
      "Consent screen",
      "8-question survey",
      "Full scoring + reasons",
      "Shareable card (EN/KO)"
    ]
  }
}